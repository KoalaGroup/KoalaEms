# $ZEL: gui.tcl,v 1.17 2014/07/10 10:26:05 wuestner Exp $
# copyright:
# 1998 P. Wuestner; Zentrallabor fuer Elektronik; Forschungszentrum Juelich
#
# global_dispwin
# global_setup
# global_daq(statustext)
# global_daq(statusentry)
# global_daq(run_nr)
# global_daq(starttime)
# global_daq(stoptime)
# global_daq()
# global_daq()
# global_daq()
# global_daq()
# global_daq()
#

proc configure_fonts {} {
    global global_setup
    global global_fonts

    # set default fonts (if they are defined in setup file)
    # acceptable targets are:
    #  Button Checkbutton Entry Label Listbox
    #  Menu Menubutton Message Radiobutton Scale

    if {[info exists global_fonts]} {
        foreach n [array names global_fonts] {
            puts "creating font for $n: \"$global_fonts($n)\""
            if [catch {eval font create Font_$n $global_fonts($n)}] {
                puts "invalid font format for $n, try XLFD"
                set fontdef [font actual $global_fonts($n)]
                puts "converted to $fontdef"
                eval font create Font_$n $fontdef
            } else {
                puts "font for $n created"
            }
            option add *$n.font Font_$n
            # option add *$n.font Font_$n userDefault
        }
    } else {
        puts "global_fonts does not exist"
    }
}

proc start_gui {} {
    configure_fonts
    crate_main_win
    create_status_display
    create_tape_display
#    create_status_frames
}

proc crate_main_win {} {
  global global_dispwin global_setup global_daq
  global entry_ro

  #set juelcolor {#01a0c6}
  set juelcolor {#005b82}

  menu .menubar
  set filemenu [create_menu_file .menubar]
  set setupmenu [create_menu_setup .menubar]
  set daqsetupmenu [create_menu_daqsetup .menubar]
  set tapemenu [create_menu_tape .menubar]
# set helpmenu [create_menu_help .menubar]

  .menubar add cascade -label File -underline 0 -menu $filemenu
  .menubar add cascade -label Setup -underline 0 -menu $setupmenu
  .menubar add cascade -label Control -underline 0 -menu $daqsetupmenu
  .menubar add cascade -label Tape -underline 0 -menu $tapemenu
# .menubar add cascade -label Help -underline 0 -menu $helpmenu

  frame .bar -height 4 -width 10c -background black
  frame .buttons
  # #f8f8c0
  button .buttons.init -background yellow -activebackground yellow\
    -borderwidth 3 -highlightthickness 0 -activeforeground white\
    -text INIT -command init_button
  # #b0ffb0
  button .buttons.start -background green -activebackground green\
    -borderwidth 3 -highlightthickness 0 -activeforeground white\
    -text START -command start_button
  # #ffb0b0
  button .buttons.stop -background red -activebackground red\
    -borderwidth 3 -highlightthickness 0 -activeforeground white\
    -text STOP -command stop_button
  # #d0d0e0
  button .buttons.pause -background #a0a0c0 -activebackground #a0a0c0\
    -borderwidth 3 -highlightthickness 0 -activeforeground white\
    -text PAUSE -command pause_button
  # #d0d0e0
  button .buttons.resume -background #a0a0c0 -activebackground #a0a0c0\
    -borderwidth 3 -highlightthickness 0 -activeforeground white\
    -text RESUME -command resume_button
  pack .buttons.init -side left -fill both -expand 1
  pack .buttons.start -side left -fill both -expand 1
  pack .buttons.stop -side left -fill both -expand 1
  pack .buttons.pause -side top -fill both -expand 1
  pack .buttons.resume -side top -fill both -expand 1
  image create bitmap sfzj -foreground white -data {
#define schrumpf-logo_width 36
#define schrumpf-logo_height 33
static char schrumpf-logo_bits[] = {
 0x00,0x00,0x00,0x00,0xf0,0x00,0x00,0x04,0x00,0xf0,0x00,0xe0,0xff,0x00,0xf0,
 0x00,0xf8,0x7f,0x00,0xf0,0x00,0xfe,0x7f,0x00,0xf0,0x00,0xff,0x3f,0x00,0xf0,
 0x80,0xff,0x3f,0x00,0xf0,0xc0,0xff,0x1f,0x00,0xf0,0xe0,0xff,0x1f,0xc0,0xf0,
 0xe0,0xff,0x1f,0xc0,0xf1,0xf0,0xff,0x0f,0xc0,0xf1,0xf0,0xff,0x0f,0xe0,0xf3,
 0xf8,0xff,0x07,0xe0,0xf3,0xf8,0xff,0x07,0xf0,0xf3,0xf8,0xff,0x07,0xf0,0xf7,
 0xf8,0xff,0x03,0xf8,0xf7,0xf8,0xff,0x03,0xf8,0xf7,0xfc,0xff,0x01,0xf8,0xf7,
 0xf8,0xf8,0x01,0xfc,0xf7,0x78,0xf8,0x00,0xfc,0xf7,0x18,0x60,0x00,0xfe,0xf7,
 0x08,0x00,0x00,0xfe,0xf3,0x00,0x00,0x00,0xff,0xf3,0x00,0x00,0x80,0xff,0xf3,
 0x00,0x00,0x80,0xff,0xf1,0x00,0x00,0xc0,0xff,0xf1,0x00,0x00,0xe0,0xff,0xf0,
 0x00,0x00,0xf0,0x7f,0xf0,0x00,0x00,0xfc,0x7f,0xf0,0x00,0x03,0xff,0x3f,0xf0,
 0x00,0xfe,0xff,0x1f,0xf0,0x00,0xfc,0xff,0x07,0xf0,0x00,0xf0,0xff,0x01,0xf0
 };}
  image create bitmap fzj -foreground $juelcolor -data {
#define screen-logo_width 73
#define screen-logo_height 67
static unsigned char screen-logo_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00,
   0x30, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0xe0, 0xff, 0x1f,
   0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0xfc, 0xff, 0x7f, 0x00, 0x00,
   0x00, 0xfe, 0x00, 0x00, 0x00, 0xff, 0xff, 0x3f, 0x00, 0x00, 0x00, 0xfe,
   0x00, 0x00, 0xe0, 0xff, 0xff, 0x3f, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00,
   0xf0, 0xff, 0xff, 0x1f, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0xfc, 0xff,
   0xff, 0x1f, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0xfe, 0xff, 0xff, 0x0f,
   0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0xff, 0xff, 0xff, 0x0f, 0x00, 0x00,
   0x00, 0xfe, 0x00, 0x80, 0xff, 0xff, 0xff, 0x0f, 0x00, 0x00, 0x00, 0xfe,
   0x00, 0xc0, 0xff, 0xff, 0xff, 0x07, 0x00, 0x00, 0x00, 0xfe, 0x00, 0xe0,
   0xff, 0xff, 0xff, 0x07, 0x00, 0x00, 0x00, 0xfe, 0x00, 0xf0, 0xff, 0xff,
   0xff, 0x03, 0x00, 0x20, 0x00, 0xfe, 0x00, 0xf8, 0xff, 0xff, 0xff, 0x03,
   0x00, 0x60, 0x00, 0xfe, 0x00, 0xfc, 0xff, 0xff, 0xff, 0x01, 0x00, 0xf0,
   0x00, 0xfe, 0x00, 0xfc, 0xff, 0xff, 0xff, 0x01, 0x00, 0xf0, 0x00, 0xfe,
   0x00, 0xfe, 0xff, 0xff, 0xff, 0x01, 0x00, 0xf0, 0x01, 0xfe, 0x00, 0xff,
   0xff, 0xff, 0xff, 0x00, 0x00, 0xf8, 0x01, 0xfe, 0x00, 0xff, 0xff, 0xff,
   0xff, 0x00, 0x00, 0xf8, 0x03, 0xfe, 0x80, 0xff, 0xff, 0xff, 0x7f, 0x00,
   0x00, 0xfc, 0x03, 0xfe, 0x80, 0xff, 0xff, 0xff, 0x7f, 0x00, 0x00, 0xfc,
   0x07, 0xfe, 0x80, 0xff, 0xff, 0xff, 0x3f, 0x00, 0x00, 0xfe, 0x07, 0xfe,
   0xc0, 0xff, 0xff, 0xff, 0x3f, 0x00, 0x00, 0xfe, 0x07, 0xfe, 0xc0, 0xff,
   0xff, 0xff, 0x3f, 0x00, 0x00, 0xfe, 0x0f, 0xfe, 0xc0, 0xff, 0xff, 0xff,
   0x1f, 0x00, 0x00, 0xff, 0x0f, 0xfe, 0xe0, 0xff, 0xff, 0xff, 0x1f, 0x00,
   0x00, 0xff, 0x0f, 0xfe, 0xe0, 0xff, 0xff, 0xff, 0x1f, 0x00, 0x80, 0xff,
   0x1f, 0xfe, 0xe0, 0xff, 0xff, 0xff, 0x0f, 0x00, 0x80, 0xff, 0x1f, 0xfe,
   0xe0, 0xff, 0xff, 0xff, 0x0f, 0x00, 0xc0, 0xff, 0x1f, 0xfe, 0xe0, 0xff,
   0xff, 0xff, 0x07, 0x00, 0xc0, 0xff, 0x1f, 0xfe, 0xe0, 0xff, 0xff, 0xff,
   0x07, 0x00, 0xc0, 0xff, 0x1f, 0xfe, 0xf0, 0xff, 0xff, 0xff, 0x03, 0x00,
   0xe0, 0xff, 0x1f, 0xfe, 0xf0, 0xff, 0xf7, 0xff, 0x03, 0x00, 0xe0, 0xff,
   0x1f, 0xfe, 0xf0, 0xff, 0xe1, 0xff, 0x01, 0x00, 0xf0, 0xff, 0x1f, 0xfe,
   0xe0, 0xff, 0xe0, 0xff, 0x01, 0x00, 0xf0, 0xff, 0x1f, 0xfe, 0xe0, 0x7f,
   0xc0, 0xff, 0x00, 0x00, 0xf8, 0xff, 0x1f, 0xfe, 0xe0, 0x1f, 0xc0, 0xff,
   0x00, 0x00, 0xf8, 0xff, 0x1f, 0xfe, 0xe0, 0x0f, 0x80, 0x7f, 0x00, 0x00,
   0xfc, 0xff, 0x1f, 0xfe, 0xe0, 0x03, 0x00, 0x3e, 0x00, 0x00, 0xfc, 0xff,
   0x1f, 0xfe, 0xe0, 0x01, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xff, 0x1f, 0xfe,
   0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xff, 0x0f, 0xfe, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x0f, 0xfe, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xff, 0xff, 0x0f, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
   0xff, 0xff, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xff, 0xff,
   0x07, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xff, 0xff, 0x07, 0xfe,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xff, 0xff, 0x03, 0xfe, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xf0, 0xff, 0xff, 0x03, 0xfe, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xf8, 0xff, 0xff, 0x01, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc,
   0xff, 0xff, 0x01, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0xff, 0xff,
   0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x7f, 0x00, 0xfe,
   0x00, 0x00, 0x00, 0x00, 0x80, 0xff, 0xff, 0x3f, 0x00, 0xfe, 0x00, 0x00,
   0x00, 0x00, 0xc0, 0xff, 0xff, 0x3f, 0x00, 0xfe, 0x00, 0x20, 0x00, 0x00,
   0xf0, 0xff, 0xff, 0x1f, 0x00, 0xfe, 0x00, 0xc0, 0x00, 0x00, 0xf8, 0xff,
   0xff, 0x0f, 0x00, 0xfe, 0x00, 0x80, 0x07, 0x00, 0xff, 0xff, 0xff, 0x07,
   0x00, 0xfe, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0x03, 0x00, 0xfe,
   0x00, 0x00, 0xfe, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0xfe, 0x00, 0x00,
   0xfc, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xfe, 0x00, 0x00, 0xf0, 0xff,
   0xff, 0xff, 0x3f, 0x00, 0x00, 0xfe, 0x00, 0x00, 0xe0, 0xff, 0xff, 0xff,
   0x1f, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x80, 0xff, 0xff, 0xff, 0x03, 0x00,
   0x00, 0xfe, 0x00, 0x00, 0x00, 0xfc, 0xff, 0xff, 0x00, 0x00, 0x00, 0xfe,
   0x00, 0x00, 0x00, 0xe0, 0xff, 0x1f, 0x00, 0x00, 0x00, 0xfe};
  }
  frame .sp -borderwidth 3 -relief ridge
  frame .sp.status -borderwidth 0 -relief flat
  label .sp.status.l1 -text "Status"
  label .sp.status.c1 -text ": "
  entry .sp.status.e1 -textvariable global_daq(statustext) -relief flat\
    -state $entry_ro
  set global_daq(statusentry) .sp.status.e1
  set global_daq(statusbackcolor) [.sp.status.e1 cget -background]
  label .sp.status.fzj -image fzj
  label .sp.status.l2 -text "run number"
  label .sp.status.c2 -text ": "
  entry .sp.status.e2 -textvariable global_daq(run_nr) -relief flat\
    -state $entry_ro
  label .sp.status.l3 -text "run started"
  label .sp.status.c3 -text ": "
  entry .sp.status.e3 -textvariable global_daq(starttime) -relief flat\
    -state $entry_ro
  label .sp.status.l4 -text "run stopped"
  label .sp.status.c4 -text ": "
  entry .sp.status.e4 -textvariable global_daq(stoptime) -relief flat\
    -state $entry_ro
  label .sp.status.l5 -text "file name"
  label .sp.status.c5 -text ": "
  entry .sp.status.e5 -textvariable global_daq(filename) -relief flat\
    -state $entry_ro

  grid configure .sp.status.l1 -column 0 -row 0 -sticky w
  grid configure .sp.status.c1 -column 1 -row 0 -sticky w
  grid configure .sp.status.e1 -column 2 -row 0 -sticky we
#  grid configure .sp.status.fzj -column 3 -row 0 -rowspan 4
  grid configure .sp.status.l2 -column 0 -row 1 -sticky w
  grid configure .sp.status.c2 -column 1 -row 1 -sticky w
  grid configure .sp.status.e2 -column 2 -row 1 -sticky we
  grid configure .sp.status.l3 -column 0 -row 2 -sticky w
  grid configure .sp.status.c3 -column 1 -row 2 -sticky w
  grid configure .sp.status.e3 -column 2 -row 2 -sticky we
  grid configure .sp.status.l4 -column 0 -row 3 -sticky w
  grid configure .sp.status.c4 -column 1 -row 3 -sticky w
  grid configure .sp.status.e4 -column 2 -row 3 -sticky we
  grid configure .sp.status.l5 -column 0 -row 4 -sticky w
  grid configure .sp.status.c5 -column 1 -row 4 -sticky w
  grid configure .sp.status.e5 -column 2 -row 4 -sticky we
  grid columnconfigure .sp.status 2 -weight 1
  pack .sp.status -fill x -expand 1 -padx 5 -pady 5

  pack .bar -side top -fill x
  pack .buttons -side top -fill x
  create_log .logframe
  frame .logo_ -borderwidth 2 -relief flat
  frame .logo_.logo -background $juelcolor
  label .logo_.logo.t -text "Forschungszentrum Jülich / ZEA - 2"\
    -background $juelcolor -foreground white -cursor {} -padx 2 -pady 2\
    -font {Helvetica -16 bold roman}
  label .logo_.logo.l -image sfzj -background $juelcolor
  pack .logo_.logo.t -side left -fill x -expand 1
  pack .logo_.logo.l -side left
  pack .logo_.logo -side bottom -fill x
  pack .logo_ -side bottom -fill x
  pack .logframe -side bottom -fill both -expand 1
  . configure -menu .menubar
  pack .sp -side left -fill x -expand 1
}

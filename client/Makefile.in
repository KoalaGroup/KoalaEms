# client/Makefile.in
# $ZEL: Makefile.in,v 2.33 2010/09/10 22:22:28 wuestner Exp $

prefix = @prefix@
exec_prefix = @exec_prefix@
BIN_DIR = $(exec_prefix)/bin
COMMONVER    := @COMMONVER@
CLIENTLIBVER := @CLIENTLIBVER@
SUPPORTVER   := @SUPPORTVER@
PROCLIBVER   := @PROCLIBVER@

srcdir = @srcdir@
VPATH = @srcdir@
@SET_MAKE@

machname = @target@

COMMON_INCLUDE = @EMSCOMMON@
COMMON_EX_INCLUDE = @EMSEXCOMMON@
COMMON_LIB = @EMSCOMMONLIB@
SUPPORT_INCLUDE = @EMSSUPPORT@
SUPPORT_LIB = @EMSSUPPORTLIB@
CLIENTLIB_INCLUDE = @EMSCLIENT@
CLIENTLIB_LIB = @EMSCLIENTLIB@
PROCLIB_INCLUDE = @EMSPROC@
PROCLIB_LIB = @EMSPROCLIB@

CXX = @CXX@
CXXFLAGS = @CXXFLAGS@ -Wall -pedantic -Woverloaded-virtual -Wsign-promo
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
RANLIB = @RANLIB@
LDFLAGS=
LIBSUFFIX := @LIBSUFFIX@

ROOTBASE   := /usr/local/root
ROOTSYS   := $(ROOTBASE)/alpha-dec-osf4.0_cxx
ROOTLIBS  := -L$(ROOTSYS)/lib -lNew -lBase -lCint -lClib -lCont -lFunc -lGraf \
            -lGraf3d -lHist -lHtml -lMatrix -lMeta -lMinuit -lNet -lPostscript \
            -lProof -lTree -lUnix -lZip
ROOTGLIBS := -lGpad -lGui -lGX11 -lX3d -lXpm -lX11
ROOTINC   := -I$(ROOTBASE)/share/include

CPPFLAGS = @CPPFLAGS@ -I$(srcdir) -I. -I$(COMMON_INCLUDE)  \
	-I$(COMMON_EX_INCLUDE)  -I$(SUPPORT_INCLUDE) -I$(CLIENTLIB_INCLUDE)  \
	-I$(PROCLIB_INCLUDE) $(ROOTINC) -DHAVE_CONFIG_H

M4FLAGS = -DCOMMON_INCLUDE=$(COMMON_INCLUDE) -DCOMMON_EX_INCLUDE=$(COMMON_EX_INCLUDE)

COMMONLIB   := -L$(COMMON_LIB) -lcommon.$(COMMONVER)
SUPPORTLIB  := -L$(SUPPORT_LIB) -lsupp.$(SUPPORTVER)
VSUPPORTLIB := -L$(SUPPORT_LIB) -lvedsupp.$(SUPPORTVER)
CLIENTLIB   := -L$(CLIENTLIB_LIB) -lemscommxx.$(CLIENTLIBVER)
PROCLIB     := -L$(PROCLIB_LIB) -lproc.$(PROCLIBVER)

RSOURCES := syncdisp2.cc #sync2root.cc dtmc.cc syncdisp.cc 
HSOURCES :=
SOURCES := eventrate.cc taperate.cc vedinfo.cc vednames.cc  \
	procprops.cc caplist.cc clientinfo.cc parasit.cc emswatch.cc  \
        datarate.cc file_empfaenger.cc illumination.cc hlraltest.cc  \
        microeventrate.cc \
	iseghv_io.cc lvd_enumerate.cc lvd_sync.cc read_scaler.cc \
        iseg_demo.cc iseg_unsol.cc iseg_crate.cc iseg_demo.cc \
        iseg_enumerate.cc show_scaler.cc decode_scaler.cc dump_scaler.cc
        #sync_hist.cc hlralloadtest.cc ralpatsearch.cc sync_topo.cc
        #atraphist.cc raltotal.cc
XSOURCES := $(SOURCES) @EXTRASOURCES@

M4HDR = emsc_message.hxx emsr_message.hxx intc_message.hxx intr_message.hxx
M4SRC = emsc_message.cc emsr_message.cc intc_message.cc intr_message.cc

M4HDR_ = $(M4HDR:=.m4)
M4SRC_ = $(M4SRC:=.m4)

WATCHSRC = ems_message.cc ems_unsol_message.cc $(M4SRC)
WATCHOBJS = $(WATCHSRC:.cc=.o)

ALLEXECS := $(XSOURCES:.cc=)
USEFULLEXECS := eventrate vedinfo vednames caplist clientinfo datarate  \
	file_empfaenger microeventrate lvd_enumerate 

.PHONY: all usefull
usefull: $(USEFULLEXECS)
all: $(EXECS)

% ::	$(srcdir)/%.m4
	m4 $(M4FLAGS) $< >$@

# $(M4HDR):	$(M$HDR_)
# 	m4 $(M4FLAGS) $(srcdir)/$@.m4 >$@
# 
# $(M4SRC):	$(M$SRC_)
# 	m4 $(M4FLAGS) $(srcdir)/$@.m4 >$@

lvdsync_sender: lvdsync_sender.o
	$(CXX) -o $@ $^ $(SUPPORTLIB)

vme_find_range: vme_find_range.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

iseg_enumerate: iseg_enumerate.o iseg_ems.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

iseg_unsol: iseg_unsol.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

read_iseg_state: read_iseg_state.o iseg_ems.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

iseg_crate: iseg_crate.o iseg_ems.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

iseg_demo: iseg_demo.o iseg_ems.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

iseg_t1: iseg_t1.o iseg_ems.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

iseg_t0: iseg_t0.o iseg_ems.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

lvd_enumerate: lvd_enumerate.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

decode_scaler: decode_scaler.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

dump_scaler: dump_scaler.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

read_scaler: read_scaler.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

show_scaler: show_scaler.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB) -lncurses -lpthread

sync_topo: sync_topo.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

iseghv_io: iseghv_io.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

microeventrate:	microeventrate.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

hlraltest:	hlraltest.o ral_testmatrix.o ral_matrix.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

hlralloadtest:	hlralloadtest.o ral_testmatrix.o ral_matrix.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

ralpatsearch:	ralpatsearch.o ral_testmatrix.o ral_matrix.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

ems_perfd:	ems_perfd.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

emswatch:	emswatch.o  $(M4HDR) $(M4SRC) $(WATCHOBJS) $(LIBS)
	$(CXX) $(LDFLAGS) -o $@ $(WATCHOBJS) $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

eventrate:	eventrate.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

dump_ved:	dump_ved.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

dump_ved1:	dump_ved1.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

# sync_hist:	sync_hist.o
# 	$(CXX) $(LDFLAGS) -o $@ $< $(LIBS)
# 
getvar:	getvar.o $(LIBS)
	$(CXX) $(LDFLAGS) -o $@ $< $(LIBS) -lm

datarate:	datarate.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

illumination:	illumination.o bong.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB) -lm

file_empfaenger: file_empfaenger.o
	$(CXX) $(LDFLAGS) -o $@ $^ $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

taperate:	taperate.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

vedinfo:	vedinfo.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

vednames:	vednames.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

procprops:	procprops.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

caplist:	caplist.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

clientinfo:	clientinfo.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

parasit:	parasit.o
	$(CXX) $(LDFLAGS) -o $@ $< $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB)

sync2root:	sync2root.o
	$(CXX) $(LDFLAGS) -o $@ $< $(LIBS) $(ROOTLIBS) -lm

syncdisp:	syncdisp.o
	$(CXX) $(LDFLAGS) -o $@ $< $(LIBS) $(ROOTLIBS) $(ROOTGLIBS) -lm

syncdisp2:	syncdisp2.o
	$(CXX) $(LDFLAGS) -o $@ $< $(LIBS) $(ROOTLIBS) $(ROOTGLIBS)  \
        $(PROCLIB) $(CLIENTLIB) $(VSUPPORTLIB)  \
	$(SUPPORTLIB) $(COMMONLIB) -lm

dtmc:	dtmc.o
	$(CXX) $(LDFLAGS) -o $@ $< $(LIBS) $(ROOTLIBS) $(ROOTGLIBS) -lm

hworld:	hworld.o
	$(CXX) $(LDFLAGS) -o $@ $< $(LIBS) $(ROOTLIBS) $(ROOTGLIBS) -lm

atraphist:	atraphist.o clusterreader.o cluster.o memory.o make_file.o  \
	$(LIBDEPS)
	$(CXX) $(LDFLAGS) -o $@ atraphist.o clusterreader.o cluster.o  \
        memory.o make_file.o  \
        -L$(PROC_LIB) -lproc.$(PROCLIBVER)  \
        -lvedsupp.$(SUPPORTVER)  \
        -L$(CLIENTLIB_LIB) -lemscommxx.$(CLIENTLIBVER)  \
        $(LIBS)

raltotal:	raltotal.o clusterreader.o cluster.o memory.o make_file.o  \
	$(LIBDEPS)
	$(CXX) $(LDFLAGS) -o $@	raltotal.o clusterreader.o cluster.o  \
	memory.o make_file.o  \
	-L$(PROC_LIB) -lproc.$(PROCLIBVER)  \
	-lvedsupp.$(SUPPORTVER)  \
	-L$(CLIENTLIB_LIB) -lemscommxx.$(CLIENTLIBVER)  \
        $(LIBS) -lX11

.PHONY: depend
depend: sed.in
	cp Makefile Makefile.bak
	sed -e '/^# DO NOT DELETE THIS LINE/,$$d' < Makefile.bak > Makefile
	echo '# DO NOT DELETE THIS LINE' >> Makefile
	echo ' ' >> Makefile
	for i in $(SOURCES) ; do \
	  echo checking $$i ; \
	  $(CXX) -M $(CPPFLAGS) $(CXXFLAGS) $(srcdir)/$$i|sed -f sed.in>> Makefile ; \
	done

sed.in:
#	echo 's|/usr/include/[^ ]*||g' >sed.in
	echo '/.*: $$/d' >>sed.in
	echo '/^ *\\ *$$/d' >>sed.in

clean:
	rm -f *.o $(EXECS) core sed.in

realclean: clean

distclean: realclean
	rm -f Makefile Makefile.bak config.cache config.log config.status config.h

install: all
	for i in $(EXECS) ; do \
		$(INSTALL) $$i $(BIN_DIR)/$$i ; \
	done
